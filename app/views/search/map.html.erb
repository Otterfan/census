<% page_title(@page_title) %>
<div id="map"></div>
<span>Mouse over a cluster to see the bounds of its children and click a cluster to zoom to those bounds</span>
<script type="text/javascript">

    const addressPoints = [<%= texts_to_mappable(@texts).join(',').html_safe %>];

    //An extract of address points from the LINZ bulk extract: http://www.linz.govt.nz/survey-titles/landonline-data/landonline-bde
    //Should be this data set: http://data.linz.govt.nz/#/layer/779-nz-street-address-electoral/

    console.log('does this happen?');

    var tiles = L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
            maxZoom: 18,
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors, Points &copy 2012 LINZ'
        }),
        latlng = L.latLng(-0, 0);

    var map = L.map('map', {center: latlng, zoom: 2, layers: [tiles]});
    console.log(map)

    var markers = L.markerClusterGroup();

    for (var i = 0; i < addressPoints.length; i++) {
        console.log(i);
        var a = addressPoints[i];
        var title = a[2];
        var marker = L.marker(new L.LatLng(a[0], a[1]), {title: title});
        marker.bindPopup(title);
        markers.addLayer(marker);
    }

    map.addLayer(markers);

</script>